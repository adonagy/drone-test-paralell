kind: pipeline
name: pipeline1

steps:
- name: P1-S1
  image: alpine/git
  user: root
  volumes:
    - name: test-dir
      path: /builds
  commands:
  - mkdir /builds/build_${DRONE_BUILD_NUMBER}
  - echo "testfile_${DRONE_BUILD_NUMBER}" > /builds/build_${DRONE_BUILD_NUMBER}/test_${DRONE_BUILD_NUMBER}.txt
  - chown -R nobody:nogroup /builds/build_${DRONE_BUILD_NUMBER}
  - ls -la /builds/build_${DRONE_BUILD_NUMBER}
  - sleep 2

volumes:
  - name: test-dir
    host:
      path: /mnt/ci-share

---

kind: pipeline
name: pipeline1-2

steps:
- name: P1-2-S1
  image: alpine/git
  user: root
  volumes:
    - name: test-dir
      path: /builds
  commands:
  - mkdir /builds/build_${DRONE_BUILD_NUMBER}_2
  - echo "testfile_${DRONE_BUILD_NUMBER}_2" > /builds/build_${DRONE_BUILD_NUMBER}_2/test_${DRONE_BUILD_NUMBER}_2.txt
  - chown -R nobody:nogroup /builds/build_${DRONE_BUILD_NUMBER}_2
  - ls -la /builds/build_${DRONE_BUILD_NUMBER}_2
  - sleep 2

volumes:
  - name: test-dir
    host:
      path: /mnt/ci-share

---

kind: pipeline
name: pipeline2

steps:
- name: P2-S1
  image: alpine/git
  user: root
  commands:
  - sleep 3
  - exit 0

- name: P2-S2
  image: alpine/git
  user: root
  commands:
  - sleep 2

- name: P2-S3
  image: alpine/git
  user: root
  volumes:
    - name: test-dir
      path: /builds
  commands:
  - sleep 2
  - ls -la /builds/build_${DRONE_BUILD_NUMBER}
  - cat /builds/build_${DRONE_BUILD_NUMBER}/test_${DRONE_BUILD_NUMBER}.txt
  - ls -la /builds/build_${DRONE_BUILD_NUMBER}_2
  - cat /builds/build_${DRONE_BUILD_NUMBER}_2/test_${DRONE_BUILD_NUMBER}_2.txt

depends_on:
  - pipeline1
  - pipeline1-2

volumes:
  - name: test-dir
    host:
      path: /mnt/ci-share

---

kind: pipeline
name: pipeline3

steps:
- name: P3-S1
  image: alpine/git
  user: root
  commands:
  - sleep 2

- name: P3-S2
  image: alpine/git
  user: root
  commands:
  - sleep 2

- name: P3-S3
  image: alpine/git
  user: root
  volumes:
    - name: test-dir
      path: /builds
  commands:
  - sleep 2
  - ls -la /builds/build_${DRONE_BUILD_NUMBER}
  - cat /builds/build_${DRONE_BUILD_NUMBER}/test_${DRONE_BUILD_NUMBER}.txt
  - ls -la /builds/build_${DRONE_BUILD_NUMBER}_2
  - cat /builds/build_${DRONE_BUILD_NUMBER}_2/test_${DRONE_BUILD_NUMBER}_2.txt

depends_on:
  - pipeline1
  - pipeline1-2

volumes:
  - name: test-dir
    host:
      path: /mnt/ci-share

---

kind: pipeline
name: pipeline4

steps:
- name: P4-S1
  image: alpine/git
  user: root
  volumes:
    - name: test-dir
      path: /builds
  commands:
  - sleep 2
  - ls -la /builds/build_${DRONE_BUILD_NUMBER}
  - cat /builds/build_${DRONE_BUILD_NUMBER}/test_${DRONE_BUILD_NUMBER}.txt
  - ls -la /builds/build_${DRONE_BUILD_NUMBER}_2
  - cat /builds/build_${DRONE_BUILD_NUMBER}_2/test_${DRONE_BUILD_NUMBER}_2.txt
  - exit 1

depends_on:
  - pipeline1
  - pipeline1-2

volumes:
  - name: test-dir
    host:
      path: /mnt/ci-share

---

kind: pipeline
name: pipeline5

steps:
- name: P5-S1
  image: alpine/git
  user: root
  volumes:
    - name: test-dir
      path: /builds
  commands:
  - sleep 2
  - ls -la /builds/build_${DRONE_BUILD_NUMBER}
  - cat /builds/build_${DRONE_BUILD_NUMBER}/test_${DRONE_BUILD_NUMBER}.txt
  - ls -la /builds/build_${DRONE_BUILD_NUMBER}_2
  - cat /builds/build_${DRONE_BUILD_NUMBER}_2/test_${DRONE_BUILD_NUMBER}_2.txt

depends_on:
  - pipeline1
  - pipeline1-2

volumes:
  - name: test-dir
    host:
      path: /mnt/ci-share

---

kind: pipeline
name: pipeline6

steps:
- name: P6-S1
  image: alpine/git
  user: root
  volumes:
    - name: test-dir
      path: /builds
  commands:
  - sleep 2
  - ls -la /builds/build_${DRONE_BUILD_NUMBER}
  - cat /builds/build_${DRONE_BUILD_NUMBER}/test_${DRONE_BUILD_NUMBER}.txt
  - ls -la /builds/build_${DRONE_BUILD_NUMBER}_2
  - cat /builds/build_${DRONE_BUILD_NUMBER}_2/test_${DRONE_BUILD_NUMBER}_2.txt

depends_on:
  - pipeline1
  - pipeline1-2

volumes:
  - name: test-dir
    host:
      path: /mnt/ci-share
---

kind: pipeline
name: pipeline7

steps:
- name: P7-S1
  image: alpine/git
  user: root
  volumes:
    - name: test-dir
      path: /builds
  commands:
  - sleep 2
  - ls -la /builds/build_${DRONE_BUILD_NUMBER}
  - cat /builds/build_${DRONE_BUILD_NUMBER}/test_${DRONE_BUILD_NUMBER}.txt
  - ls -la /builds/build_${DRONE_BUILD_NUMBER}_2
  - cat /builds/build_${DRONE_BUILD_NUMBER}_2/test_${DRONE_BUILD_NUMBER}_2.txt

depends_on:
  - pipeline1
  - pipeline1-2

volumes:
  - name: test-dir
    host:
      path: /mnt/ci-share

---

kind: pipeline
name: pipeline8

steps:
- name: P8-S1
  image: alpine/git
  user: root
  volumes:
    - name: test-dir
      path: /builds
  commands:
  - sleep 2
  - ls -la /builds/build_${DRONE_BUILD_NUMBER}
  - cat /builds/build_${DRONE_BUILD_NUMBER}/test_${DRONE_BUILD_NUMBER}.txt
  - ls -la /builds/build_${DRONE_BUILD_NUMBER}_2
  - cat /builds/build_${DRONE_BUILD_NUMBER}_2/test_${DRONE_BUILD_NUMBER}_2.txt

depends_on:
  - pipeline1
  - pipeline1-2

volumes:
  - name: test-dir
    host:
      path: /mnt/ci-share